# HTTPS证书验证分析
## HTTP缺点
* 通信使用明文(不加密)，内容可能会被窃听
* 不验证通信方的身份，因此可能遭遇伪装
* 无法证明报文的完整性，所以有可能已遭篡改

## 加密处理防止被窃听
### 通信的加密
通过和SSL、TSL的组合使用，加密HTTP通信内容。

###内容的加密

## HTTPS
HTTPS 是承载在TLS/SSL之上的HTTP，相较于HTTP明文数据传输方面所暴露出的缺点，HTTPS 具有防止信息被窃听、篡改、劫持、提供信息加密，完整性校验及身份验证等优势。

访问一个正常的HTTPS链接:
* 认证服务器身份，确保数据发送到正确的服务器；
* 加密数据以防止数据中途被窃取
* 维护数据的完整性，确保数据在传输过程中不被改写。

## HTTPS 安全通信机制
## 第一阶段：ClientHello
客户端发起请求，以明文传输请求信息，包含版本信息，加密套件候选列表，压缩算法候选列表，随机数random_C，扩展字段等信息。

## 第二阶段: ServerHello－ServerHelloDone

服务端返回协商的信息结果，包括选择使用的协议版本，选择的加密套件，选择的压缩算法、随机数random_S等，其中随机数用于后续的密钥协商。服务器也会配置并返回对应的证书链Certificate，用于身份验证与密钥交换。然后会发送ServerHelloDone信息用于通知服务器信息发送结束。

## 第三阶段: 证书校验
客户端这边需要对服务器返回的证书进行校验，只有证书验证通过之后，才能进行后续的通信。

## 第四阶段: ClientKeyExchange－Finished
服务器返回的证书验证合法后，客户端计算产生随机数字Pre-master，并用server证书中公钥加密，发送给服务器，同时客户端会根据已有的三个随机数根据相应的生成协商密钥。客户端会通知服务器后续的通信都采用协商的通信密钥和加密算法进行加密通信。然后客户端发送Finished消息用于通知客户端信息发送结束。

## 第五阶段: 服务器端生成协商密钥
服务器也会根据已有的三个随机数使用相应的算法生成协商密钥，会通知客户端后续的通信都采用协商密钥和加密算法进行加密通信。然后发送Finished消息用于通知服务器信息发送结束。

## 第六阶段:握手结束
在握手阶段结束后，客户端和服务器数据传输开始使用协商密钥进行加密通信。

## 总结
HTTPS 请求整个过程主要分为两部分,一是握手过程: 用于客户端和服务器验证双方身份，协商后续数据传输时使用到的秘钥等。二是数据传输过程: 身份验证通过并协商秘钥后，通信双方使用协商好的秘钥加密数据并进行通信，在握手过程协商秘钥时，使用的是非对称密钥交换算法， 密钥交换算法本身非常复杂，密钥交换过程涉及到随机数生成，模指数运算，空白补齐，加密，签名等操作。在数据传输过程中，客户端和服务器端使用协商好的密钥进行对称加密解密。

## PS
客户端向服务器端索要并验证公钥；
双方协商生成"对话密钥"；
双方采用"对话密钥"进行加密通信

# 证书
## 证书申请过程
* 证书申请者向颁发证书的可信第三方CA提交申请证书相关信息，包括：申请者域名、申请者生成的公钥(私钥自己保存)及证书请求文件.cer等
* 认证中心通过线上、线下等多种手段验证证书申请者提供的信息合法和真实性。
  
* 当证书申请者提供的信息审核通过后，CA向证书申请者颁发证书，证书内容包括明文信息和签名信息。其中明文信息包括证书颁发机构、证书有效期、域名、申请者相关信息及申请者公钥等，签名信息是**使用CA私钥进行加密的明文信息**。当证书申请者获取到证书后，可以通过安装的**CA证书中的公钥对签名信息进行解密并与明文信息进行对比来验证签名的完整性。**

## 证书验证过程
* 验证证书本身的合法性(验证签名完整性，验证证书有效期等)
* 验证证书颁发者的合法性(查找颁发者的证书并检查其合法性，这个过程是递归的)

## 验证信息
* 证书是否过期
* 发行服务器证书的CA是否可靠
* 返回的公钥是否能正确解开返回证书中的数字 签名
* 服务器证书上的域名是否和服务器的实际域名相匹配
* 数字证书。该信息是我们进行开发需要关注的！数字证书包含了公钥等信息，一般由服务器发给客户端，接收方通过验证这个证书是不是由信赖的CA签发，或者与本地的证书相对比，来判断证书是否可信；假如需要双向验证，则服务器和客户端都需要发送数字证书给对方验证
验证通过后，将继续进行通信，否则，终止通信


> https://zhuanlan.zhihu.com/p/22749689